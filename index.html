<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Banner</title>
    <script src="/js/jquery.min.js"></script>
    <script src="/js/qrcode.js"></script>
    <script src="/js/jquery.qrcode.js"></script>
    <style>
        body {
            margin: 0px;
            margin-top: 7px;
            padding: 0px;
        }
    </style>
</head>
<body onload="setTimeout('this.location.reload();',600000)">
</body>
<script>

    $(function () {

        var retry = 0;

        function connectServer() {

            var ws = new WebSocket('ws://center.yao-yang.cn:49999/');

            ws.onclose = function () {
                retry ++;
                if (retry < 10) {
                    connectServer();
                } else {
                    $.get("/read", function(result){
                        $('body').html(result);
                    });

                    setInterval(function () {
                        $.get("/read", function(result){
                            $('body').html(result);
                        });
                    }, 5000);
                }
            };

            ws.onmessage = function (event) {
                if (typeof event.data === 'string') {
                    var res = JSON.parse(event.data);
                    if (res.content === '<br />') {
                        res.content = '<div class="qrcode"></div>';
                        $('body').html(res.content);
                        $('.qrcode').qrcode({
                            text: window.location.href + 'editor.html',
                            width: 190, //宽度
                            height: 190, //高度
                            color: "#aaaaaa",
                            correctLevel: QRErrorCorrectLevel.M
                        });
                    } else {
                        $('body').html(res.content);
                    }
                }
            };

            ws.onopen = function () {
                ws.send(JSON.stringify({
                    banner: true
                }));
            };

            return ws;
        }

        connectServer();
    });

</script>
</html>
